<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slimer - Game</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    
    <script type="module">
        import {LevelLoader} from "https://unpkg.com/type3games-engine/engine.js"
        import {Event} from "https://unpkg.com/type3games-engine/coretools.js"
            console.log(LevelLoader);
            let loader = new LevelLoader({pathPrefix:"",levelList:["tutorial","level","level3","level1","level2","level4","level5","leveltest"]})
            Event.on("DefaultSettingsJSONLoaded",()=>{
                loader.loadJSON("./tutorial.json")
            })
            loader.loadDefaultFromJSON("./levelSettings.json")
            let time = 0;
            let level;
            let totalTime = 0;
            
            Event.on("LevelLoading",(lvl)=>{
                level = lvl;
                totalTime += time;
                time = 0;
            })
            
            Event.on("Frame",(deltaTime)=>{
                time+=deltaTime;
                if (time>level.maxTime){
                    Event.emit("End")
                    loader.loadJSON(`./${level.name}.json`)
                }
                
            })

            Event.on("RenderHUD",(ctx,canvas)=>{
                ctx.fillStyle = "black"
                ctx.font = "100px FieldGuide, sans-serif"
                let timeToRender = level.maxTime - time 
                timeToRender = Math.floor(timeToRender*1000)/1000
                     ctx.fillText(`${timeToRender}s`,canvas.width-300,100)
                
            })

            Event.on("NoMoreLevels",()=>{
                totalTime += time;
                Event.emit("End")
                let h1 = document.createElement("h1");
                let a = document.createElement("a");
                let button =document.createElement("button");
                button.className = "menu-btn"
                button.innerText = "Retry"
                a.href = "./index.html"
                a.appendChild(button)
                let button2 =document.createElement("button");
                button2.className = "menu-btn"
                button2.innerText = "Feedback"
                let a2 = document.createElement("a");
                a2.href = "https://docs.google.com/forms/d/e/1FAIpQLSf0uOhSqOoGlKBKwCfAeQKKaHGlcCr5zbJ7SKkjBGPYIHPHvg/viewform?usp=dialog"
                a2.target="_blank"
                a2.appendChild(button2)
                h1.innerHTML = `You Win!<br>in ${Math.floor((totalTime)*1000)/1000}s`;
                document.body.appendChild(h1)
                document.body.appendChild(a);
                document.body.appendChild(a2);
            })

            let title =document.querySelector("title")
            // Event.on("NextLevel",()=>{
            //     console.log(`time:${time}s`)
            //     title.innerHTML = `time:${time}s`
            //     time = 0;
            // })
            // Event.on("MaxSpeedReached",()=>{
            //     console.log(`MaxSpeedReached!`)
            // })
    </script>
</body>
</html>